@advice(QM)
rtVilScript enactment(Project source, Configuration config, Project target, AdaptationEvent event) {

    enact(Project source, Configuration changed, Project target) = : {
    	QM qm = config.selectChangedWithContext();
    	if (!config.isEmpty()) {
            CommandSequence cmd = new CommandSequence();
	        map(Pipeline p:qm.pipelines) {
	            map(Source s:p.sources) {
	                enact(p, cmd, s);
	            };
	        };
            cmd.exec();
        }
    }
    
    enact(Pipeline pipeline, CommandSequence cmd, PipelineNode node) = {
        // dynamic dispatch default – do nothing    
    }
    
    enact(Pipeline pipeline, CommandSequence cmd, Source source) = {
        map(Flow f:source.output) {
            enact(pipeline, cmd, f.destination);
        };
    }
    
    enact(Pipeline pipeline, CommandSequence cmd, FamilyElement elt) = {
        Family family = elt.family;
        if (elt.actual != null) {
            cmd.add(new AlgorithmChangeCommand(pipeline.name, elt.name, elt.actual.name));
        }
        map(Flow f:elt.output) {
            enact(pipeline, cmd, f.destination);
        };        
    }

}